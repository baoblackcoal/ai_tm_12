<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>示波器智能交互系统 - 高校实验场景</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
        }
        .scope-interface {
            position: relative;
            margin: 40px auto;
            width: 1000px;
            height: 680px;
            background-color: #111;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
        }
        .scope-header {
            background-color: #222;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }
        .scope-status {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
        }
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .status-dot.connected {
            background-color: #4ade80;
        }
        .status-dot.disconnected {
            background-color: #ef4444;
        }
        .status-dot.running {
            background-color: #3b82f6;
        }
        .status-dot.stopped {
            background-color: #f97316;
        }
        .main-content {
            display: flex;
            flex: 1;
            height: calc(100% - 50px); /* 减去头部状态栏的高度 */
            overflow: hidden;
        }
        .scope-display {
            flex: 2;
            background-color: #000;
            position: relative;
            overflow: hidden;
            border-right: 1px solid #333;
        }
        .scope-screen {
            width: 100%;
            height: 100%;
            object-fit: contain;
            max-height: 100%;
            display: block;
        }
        .chat-interface {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #333;
            height: 100%;
            overflow: hidden;
        }
        .chat-messages {
            flex: 1;
            overflow-y: scroll;
            padding: 15px;
            height: calc(100% - 70px); /* 减去输入区域的高度 */
            scrollbar-width: thin;
            scrollbar-color: #444 #222;
        }
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }
        .chat-messages::-webkit-scrollbar-track {
            background: #222;
            border-radius: 4px;
        }
        .chat-messages::-webkit-scrollbar-thumb {
            background-color: #444;
            border-radius: 4px;
            border: 2px solid #222;
        }
        .message {
            margin-bottom: 15px;
            max-width: 90%;
        }
        .message-content {
            padding: 10px 12px;
            border-radius: 8px;
            overflow-wrap: break-word;
        }
        .user-message {
            margin-left: auto;
        }
        .user-message .message-content {
            background-color: #0b84ff;
            color: white;
            border-bottom-right-radius: 2px;
        }
        .ai-message {
            margin-right: auto;
        }
        .ai-message .message-content {
            background-color: #2c2c2e;
            color: white;
            border-bottom-left-radius: 2px;
        }
        .command-preview {
            background-color: #1e293b;
            color: #94a3b8;
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
            font-family: monospace;
            white-space: pre-wrap;
            border-left: 3px solid #3b82f6;
        }
        .confirmation-buttons {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        .confirm-button {
            background-color: #4ade80;
            color: #0f172a;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
        }
        .modify-button {
            background-color: #f59e0b;
            color: #0f172a;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
        }
        .cancel-button {
            background-color: #ef4444;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
        }
        .execution-status {
            background-color: rgba(30, 41, 59, 0.5);
            border-radius: 8px;
            padding: 8px;
            margin-top: 8px;
            font-size: 14px;
        }
        .status-step {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }
        .status-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .status-text {
            flex: 1;
        }
        .complete-step {
            color: #4ade80;
        }
        .active-step {
            color: #3b82f6;
        }
        .pending-step {
            color: #94a3b8;
        }
        .error-step {
            color: #ef4444;
        }
        .measurement-result {
            background-color: #1e293b;
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
            border-left: 3px solid #8b5cf6;
        }
        .result-header {
            font-weight: bold;
            margin-bottom: 8px;
            color: #a78bfa;
        }
        .result-value {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        .result-unit {
            color: #94a3b8;
            font-size: 14px;
        }
        .result-image {
            width: 100%;
            border-radius: 4px;
            margin-top: 8px;
        }
        .code-block {
            background-color: #1e293b;
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
            font-family: monospace;
            white-space: pre-wrap;
            border-left: 3px solid #8b5cf6;
            font-size: 13px;
            overflow-x: auto;
        }
        .code-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            color: #a78bfa;
            font-weight: bold;
        }
        .copy-button {
            background-color: #2d3748;
            color: #cbd5e0;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        .copy-button:hover {
            background-color: #4a5568;
        }
        .chat-input {
            flex-shrink: 0;
            height: 70px;
            display: flex;
            padding: 15px;
            background-color: #1c1c1e;
            border-top: 1px solid #333;
        }
        .input-field {
            flex: 1;
            padding: 10px 15px;
            background-color: #2c2c2e;
            border: none;
            border-radius: 20px;
            color: white;
            outline: none;
        }
        .input-button {
            width: 40px;
            height: 40px;
            background-color: #0b84ff;
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            cursor: pointer;
        }
        .input-button.mic {
            background-color: #4ade80;
        }
        .instrument-dashboard {
            background-color: #1c1c1e;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
        }
        .instrument-card {
            background-color: #2c2c2e;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 8px;
        }
        .instrument-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }
        .instrument-name {
            font-weight: bold;
            color: #a78bfa;
        }
        .instrument-status {
            font-size: 12px;
            color: #94a3b8;
        }
        .instrument-params {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 4px;
            font-size: 12px;
        }
        .param-label {
            color: #94a3b8;
        }
        .param-value {
            color: white;
        }
        .safety-warning {
            background-color: #ef4444;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 8px 0;
        }
        .data-table th,
        .data-table td {
            border: 1px solid #333;
            padding: 8px;
            text-align: left;
        }
        .data-table th {
            background-color: #2c2c2e;
        }
        .chart-container {
            width: 100%;
            height: 200px;
            background-color: #1c1c1e;
            border-radius: 8px;
            margin: 8px 0;
            position: relative;
        }
        .chart-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #94a3b8;
            text-align: center;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="flex items-center mb-8">
            <a href="../index.html" class="text-green-500 hover:text-green-400">
                <i class="fas fa-arrow-left mr-2"></i>返回
            </a>
            <h1 class="text-2xl font-bold text-green-500 ml-4">阶段 2: 指令集 AI Agent 控制系统 - 高校实验场景</h1>
        </div>
        
        <div class="text-center mb-8">
            <p class="text-gray-400 max-w-2xl mx-auto">将自然语言指令转化为 SCPI 命令，控制示波器、信号发生器、电源等仪器完成实验任务。</p>
        </div>

        <!-- 示波器界面模拟 -->
        <div class="scope-interface">
            <!-- 头部状态栏 -->
            <div class="scope-header">
                <div class="text-lg font-bold">示波器智能控制系统</div>
                <div class="scope-status">
                    <div class="status-indicator">
                        <div class="status-dot connected"></div>
                        <span>已连接</span>
                    </div>
                    <div class="status-indicator">
                        <div class="status-dot running"></div>
                        <span>运行中</span>
                    </div>
                    <div class="status-indicator">
                        <div class="text-sm">IP: 192.168.1.105</div>
                    </div>
                </div>
            </div>

            <!-- 主体内容区 -->
            <div class="main-content">
                <!-- 示波器显示区 -->
                <div class="scope-display">
                    <img src="https://www.owon.com.hk/Upload/PicFiles/2025441345476589.png" alt="示波器屏幕" class="scope-screen">
                </div>

                <!-- 对话交互区 -->
                <div class="chat-interface">
                    <div class="chat-messages">
                        <!-- AI 欢迎消息 -->
                        <div class="message ai-message">
                            <div class="message-content">
                                欢迎使用示波器指令控制系统！我可以帮您控制实验室仪器完成实验任务。当前已连接：
                                <div class="instrument-dashboard">
                                    <div class="instrument-card">
                                        <div class="instrument-header">
                                            <div class="instrument-name">示波器 (FDS4112)</div>
                                            <div class="instrument-status">已连接</div>
                                        </div>
                                        <div class="instrument-params">
                                            <div class="param-label">时基</div>
                                            <div class="param-value">1ms/div</div>
                                            <div class="param-label">通道 1</div>
                                            <div class="param-value">1V/div</div>
                                            <div class="param-label">通道 2</div>
                                            <div class="param-value">1V/div</div>
                                        </div>
                                    </div>
                                    <div class="instrument-card">
                                        <div class="instrument-header">
                                            <div class="instrument-name">信号发生器 (FDS4112)</div>
                                            <div class="instrument-status">已连接</div>
                                        </div>
                                        <div class="instrument-params">
                                            <div class="param-label">波形</div>
                                            <div class="param-value">正弦波</div>
                                            <div class="param-label">频率</div>
                                            <div class="param-value">1kHz</div>
                                            <div class="param-label">幅度</div>
                                            <div class="param-value">1Vpp</div>
                                        </div>
                                    </div>
                                    <div class="instrument-card">
                                        <div class="instrument-header">
                                            <div class="instrument-name">电源 (FDS4112)</div>
                                            <div class="instrument-status">已连接</div>
                                        </div>
                                        <div class="instrument-params">
                                            <div class="param-label">通道 1</div>
                                            <div class="param-value">+12V</div>
                                            <div class="param-label">通道 2</div>
                                            <div class="param-value">-12V</div>
                                        </div>
                                    </div>
                                </div>
                                请问需要进行什么实验测量？
                            </div>
                        </div>

                        <!-- 用户指令 -->
                        <div class="message user-message">
                            <div class="message-content">
                                测量运放电路的开环增益特性，需要从 100Hz 到 1MHz 扫频，每个频率点记录输入输出电压
                            </div>
                        </div>

                        <!-- AI 操作计划 -->
                        <div class="message ai-message">
                            <div class="message-content">
                                <div class="safety-warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <span>注意：测量开环增益时需要注意以下事项：
                                        1. 输入信号幅度不要太大，避免饱和
                                        2. 确保运放供电电压正确
                                        3. 注意共地连接</span>
                                </div>
                                
                                我将帮您完成开环增益测量，具体步骤如下：

                                <div class="mt-4 bg-gray-800 rounded-lg p-4">
                                    <div class="font-bold mb-2">实验步骤：</div>
                                    <ol class="list-decimal pl-4 space-y-2">
                                        <li>设置运放供电电压：±12V</li>
                                        <li>配置示波器：
                                            <ul class="list-disc pl-4 mt-1">
                                                <li>CH1: 输入信号 (10mV/div)</li>
                                                <li>CH2: 输出信号 (2V/div)</li>
                                                <li>时基：根据频率自动调整</li>
                                            </ul>
                                        </li>
                                        <li>配置信号发生器：
                                            <ul class="list-disc pl-4 mt-1">
                                                <li>正弦波，10mVpp</li>
                                                <li>从 100Hz 开始扫频</li>
                                            </ul>
                                        </li>
                                    </ol>
                                </div>

                                <div class="mt-4">
                                    这是我计划执行的命令序列：
                                    <div class="command-preview">
    // 1. 设置电源
    :FDS4112:PS:CH1 12V
    :FDS4112:PS:CH2 -12V
    :FDS4112:PS:OUTPUT ON

    // 2. 配置示波器
    :FDS4112:CH1:SCALE 10mV
    :FDS4112:CH2:SCALE 2V
    :FDS4112:TIMEBASE:MODE AUTO
    :FDS4112:TRIGGER:MODE AUTO

    // 3. 配置信号发生器
    :FDS4112:WAVE:SHAPE SIN
    :FDS4112:WAVE:AMPL 10mV
    :FDS4112:WAVE:OFFSET 0V
    :FDS4112:OUTPUT ON

    // 4. 开始扫频测量
    for freq in [100, 200, 500, 1k, 2k, 5k, 10k, 20k, 50k, 100k, 200k, 500k, 1M]:
        :FDS4112:WAVE:FREQ {freq}
        :FDS4112:MEASURE:VPP? CH1
        :FDS4112:MEASURE:VPP? CH2
        :FDS4112:MEASURE:PHASE? CH1,CH2</div>
                                </div>

                                <div class="confirmation-buttons">
                                    <div class="confirm-button">开始测量</div>
                                    <div class="modify-button">调整参数</div>
                                    <div class="cancel-button">取消</div>
                                </div>
                            </div>
                        </div>

                        <!-- AI 执行状态 -->
                        <div class="message ai-message">
                            <div class="message-content">
                                <div class="execution-status">
                                    <div class="status-step complete-step">
                                        <div class="status-icon"><i class="fas fa-check-circle"></i></div>
                                        <div class="status-text">电源设置完成</div>
                                    </div>
                                    <div class="status-step complete-step">
                                        <div class="status-icon"><i class="fas fa-check-circle"></i></div>
                                        <div class="status-text">示波器配置完成</div>
                                    </div>
                                    <div class="status-step active-step">
                                        <div class="status-icon"><i class="fas fa-spinner fa-spin"></i></div>
                                        <div class="status-text">正在进行频率扫描 (7/13)</div>
                                    </div>
                                </div>

                                <div class="mt-4">
                                    <div class="font-bold">实时测量数据：</div>
                                    <div class="data-table">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>频率</th>
                                                    <th>输入 (mVpp)</th>
                                                    <th>输出 (Vpp)</th>
                                                    <th>增益 (dB)</th>
                                                    <th>相位差 (°)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>100 Hz</td>
                                                    <td>10.2</td>
                                                    <td>8.45</td>
                                                    <td>58.3</td>
                                                    <td>-2.1</td>
                                                </tr>
                                                <tr>
                                                    <td>200 Hz</td>
                                                    <td>10.1</td>
                                                    <td>8.42</td>
                                                    <td>58.4</td>
                                                    <td>-4.3</td>
                                                </tr>
                                                <tr>
                                                    <td>500 Hz</td>
                                                    <td>10.1</td>
                                                    <td>8.38</td>
                                                    <td>58.3</td>
                                                    <td>-10.5</td>
                                                </tr>
                                                <tr>
                                                    <td>1 kHz</td>
                                                    <td>10.0</td>
                                                    <td>8.21</td>
                                                    <td>58.2</td>
                                                    <td>-21.2</td>
                                                </tr>
                                                <tr>
                                                    <td>2 kHz</td>
                                                    <td>10.1</td>
                                                    <td>7.85</td>
                                                    <td>57.8</td>
                                                    <td>-42.5</td>
                                                </tr>
                                                <tr>
                                                    <td>5 kHz</td>
                                                    <td>10.0</td>
                                                    <td>6.92</td>
                                                    <td>56.8</td>
                                                    <td>-89.3</td>
                                                </tr>
                                                <tr>
                                                    <td>10 kHz</td>
                                                    <td>10.1</td>
                                                    <td>5.23</td>
                                                    <td>54.3</td>
                                                    <td>-135.2</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="mt-4">
                                    <div class="chart-container">
                                        <div class="chart-placeholder">
                                            <i class="fas fa-chart-line text-4xl mb-2"></i>
                                            <div>增益-频率特性曲线</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-4">
                                    <div class="bg-blue-900 text-blue-100 rounded-lg p-4">
                                        <div class="font-bold mb-2">实时分析：</div>
                                        <ul class="list-disc pl-4">
                                            <li>当前测得开环增益约为 58dB</li>
                                            <li>-3dB 频率点预计在 15kHz 左右</li>
                                            <li>相位裕度约为 45°</li>
                                            <li>建议在 10kHz 以下使用，以确保稳定性</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 输入区域 -->
                    <div class="chat-input">
                        <input type="text" class="input-field" placeholder="输入指令或问题...">
                        <button class="input-button mic">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="input-button">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 设计说明 -->
        <div class="mt-16 max-w-4xl mx-auto">
            <h2 class="text-xl font-bold text-green-500 mb-4">设计说明</h2>
            <div class="bg-gray-800 rounded-xl p-6">
                <h3 class="font-bold mb-2">高校实验场景优化</h3>
                <p class="text-gray-400 mb-4">本界面针对高校模电/数电实验场景进行了专门优化，支持多仪器协同控制和实验数据记录。</p>
                
                <h3 class="font-bold mb-2">核心功能展示</h3>
                <ul class="list-disc pl-6 text-gray-400 space-y-2">
                    <li>多仪器状态监控面板，实时显示各仪器参数</li>
                    <li>自然语言指令解析为多仪器协同操作计划</li>
                    <li>安全警告提示，确保实验安全</li>
                    <li>实验数据自动记录和可视化</li>
                    <li>数据导出功能，方便实验报告撰写</li>
                </ul>
                
                <h3 class="font-bold mt-4 mb-2">设计特点</h3>
                <ul class="list-disc pl-6 text-gray-400 space-y-2">
                    <li>分区合理的双栏布局，左侧为示波器显示，右侧为交互界面</li>
                    <li>醒目的状态指示器，清晰展示连接和运行状态</li>
                    <li>结构化的命令预览，便于用户理解将要执行的操作</li>
                    <li>高对比度的深色专业界面，符合测试仪器使用场景</li>
                    <li>详细的执行反馈，消除操作不确定性</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // 简单交互演示
        document.addEventListener('DOMContentLoaded', function() {
            const confirmButton = document.querySelector('.confirm-button');
            const statusMessage = document.querySelector('.execution-status');
            const resultMessage = document.querySelector('.message-content .data-table').parentNode.parentNode;
            const chatMessages = document.querySelector('.chat-messages');
            
            // 初始隐藏状态消息和结果
            statusMessage.parentNode.parentNode.style.display = 'none';
            resultMessage.style.display = 'none';
            
            // 确保聊天窗口初始滚动到底部
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            confirmButton.addEventListener('click', function() {
                // 显示状态消息
                statusMessage.parentNode.parentNode.style.display = 'block';
                
                // 滚动到可见
                setTimeout(function() {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 100);
                
                // 3秒后显示结果
                setTimeout(function() {
                    resultMessage.style.display = 'block';
                    // 确保结果可见
                    setTimeout(function() {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 100);
                }, 3000);
            });
            
            // 确保图片加载完成后布局正确
            const scopeImage = document.querySelector('.scope-screen');
            scopeImage.onload = function() {
                // 确保图片适配容器
                const display = scopeImage.parentElement;
                if (scopeImage.naturalHeight / scopeImage.naturalWidth > display.clientHeight / display.clientWidth) {
                    scopeImage.style.height = '100%';
                    scopeImage.style.width = 'auto';
                }
            };
        });
    </script>
</body>
</html> 